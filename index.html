<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Premium Vectorizer — Hybrid (v2.8)</title>
  <meta name="description" content="Hybrid raster→SVG vectorizer with Lab KMeans, poster/text cleanup, and custom presets." />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html,body{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
    .card{border-radius:1rem;border:1px solid rgba(255,255,255,0.06);background:rgba(15,23,42,0.6);backdrop-filter:blur(6px);box-shadow:0 10px 35px rgba(0,0,0,.35)}
    .help details{border-left:2px solid rgba(148,163,184,.35);padding-left:.75rem;margin-top:.25rem}
    .help summary{list-style:none;cursor:pointer;display:inline-flex;align-items:center;gap:.35rem;color:#cbd5e1;font-size:.8rem}
    .help summary::-webkit-details-marker{display:none}
    .badge{font-size:.675rem;padding:.15rem .5rem;border-radius:.5rem;border:1px solid rgba(148,163,184,.35);color:#cbd5e1}
    .btn{display:inline-flex;align-items:center;gap:.5rem;border-radius:.6rem;padding:.55rem .85rem;font-weight:600}
    .btn-primary{background:#f8fafc;color:#0f172a}
    .btn-primary:hover{background:#ffffff}
    .btn-ghost{border:1px solid #334155;color:#e2e8f0;background:transparent}
    .btn-ghost:hover{background:#0b1220}
    .slider-row{display:grid;grid-template-columns:1fr auto;align-items:center}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}
  </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-slate-950 via-slate-900 to-slate-950 text-slate-100 selection:bg-slate-700/60">
  <header class="max-w-[1600px] mx-auto px-4 py-6 flex items-center gap-3">
    <div class="w-9 h-9 rounded-xl bg-gradient-to-br from-indigo-400 to-purple-400 flex items-center justify-center shadow-lg">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-slate-950" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path d="M3 3h7l2 3h9v13a2 2 0 0 1-2 2H3z" stroke-width="2" />
        <path d="M7 13h10M7 17h6M7 9h10" stroke-width="2" />
      </svg>
    </div>
    <div>
      <h1 class="text-xl font-semibold tracking-tight">Premium Vectorizer</h1>
      <p class="text-xs text-slate-400">Hybrid: classical + optional AI refine</p>
    </div>
    <div class="ml-auto flex items-center gap-2">
      <span class="badge">Standalone</span>
      <span class="badge">v2.8</span>
    </div>
  </header>

  <main class="max-w-[1600px] mx-auto px-4 pb-14 grid grid-cols-1 lg:grid-cols-12 gap-6">
    <!-- Controls (sticky) -->
    <aside class="lg:col-span-4 xl:col-span-3">
      <section class="card p-5 space-y-5 sticky top-6">
        <div class="flex items-center justify-between">
          <h2 class="text-lg font-semibold">Controls</h2>
          <button id="resetAll" class="btn btn-ghost" title="Reset all to defaults">Reset</button>
        </div>

        <!-- Presets toolbar -->
        <div class="flex items-center gap-2">
          <select id="presetSelect" class="w-full bg-slate-900/50 border border-slate-700 rounded-md px-3 py-2 text-sm"></select>
          <button id="savePreset" class="btn btn-ghost" title="Save current as preset">Save</button>
          <button id="deletePreset" class="btn btn-ghost" title="Delete selected preset">Delete</button>
        </div>

        <div>
          <label class="block text-sm text-slate-300" for="file">Upload image</label>
          <div class="mt-2 flex items-center gap-2">
            <input id="file" type="file" accept="image/*" class="block w-full text-sm file:mr-3 file:px-3 file:py-2 file:rounded-md file:border-0 file:bg-slate-200 file:text-slate-900 hover:file:bg-white" />
            <button id="resetBtn" class="btn btn-ghost">Clear</button>
          </div>
          <p class="mt-1 text-xs text-slate-400">PNG / JPG / WebP recommended. Large images are downscaled to max 3000px on the longer side.</p>
        </div>

        <!-- PREPROCESS -->
        <div>
          <h3 class="text-sm font-semibold">1) Preprocess & Quantize</h3>
          <div class="slider-row mt-2"><label class="text-sm">Colors (K)</label><span id="kVal" class="text-xs text-slate-300">12</span></div>
          <input id="k" type="range" min="2" max="64" step="1" value="12" class="w-full mt-1" />
          <div class="slider-row mt-2"><label class="text-sm">Edge-preserve smoothing</label><span id="smoothVal" class="text-xs text-slate-300">1</span></div>
          <input id="smooth" type="range" min="0" max="2" step="1" value="1" class="w-full mt-1" />
          <div class="help"><details><summary>What are these?</summary>
            <p class="mt-1 text-xs text-slate-300">We first simplify colors using KMeans in the CIE‑Lab space (perceptual). A small guided smoothing pass reduces noise while keeping edges.</p>
          </details></div>

          <div class="grid grid-cols-2 gap-3 mt-2">
            <div>
              <div class="slider-row"><label class="text-sm">Snap near-white → white</label><span id="wVal" class="text-xs text-slate-300">245</span></div>
              <input id="whiteT" type="range" min="200" max="255" step="1" value="245" class="w-full mt-1" />
            </div>
            <div>
              <div class="slider-row"><label class="text-sm">Snap near-black → black</label><span id="bVal" class="text-xs text-slate-300">25</span></div>
              <input id="blackT" type="range" min="0" max="80" step="1" value="25" class="w-full mt-1" />
            </div>
          </div>
          <label class="inline-flex items-center gap-2 text-xs mt-2"><input id="desat" type="checkbox" class="accent-slate-300" /> Desaturate first (grayscale)</label>
        </div>

        <!-- VECTORIZER -->
        <div>
          <h3 class="text-sm font-semibold mt-3">2) Vectorize</h3>
          <div class="slider-row mt-2"><label class="text-sm">Corner fidelity (ltres)</label><span id="ltVal" class="text-xs text-slate-300">1.0</span></div>
          <input id="ltres" type="range" min="0.5" max="3" step="0.1" value="1.0" class="w-full mt-1" />
          <div class="slider-row mt-2"><label class="text-sm">Curve smoothness (qtres)</label><span id="qtVal" class="text-xs text-slate-300">1.0</span></div>
          <input id="qtres" type="range" min="0.5" max="3" step="0.1" value="1.0" class="w-full mt-1" />
          <div class="slider-row mt-2"><label class="text-sm">Min area / despeckle</label><span id="omitVal" class="text-xs text-slate-300">8</span></div>
          <input id="pathomit" type="range" min="0" max="80" step="1" value="8" class="w-full mt-1" />
          <div class="slider-row mt-2"><label class="text-sm">Coordinate precision</label><span id="rcVal" class="text-xs text-slate-300">2</span></div>
          <input id="roundcoords" type="range" min="0" max="3" step="0.5" value="2" class="w-full mt-1" />
        </div>

        <div class="flex items-center justify-between pt-2">
          <label class="inline-flex items-center gap-2 text-sm"><input id="autoprev" type="checkbox" class="accent-slate-300" checked /> Live preview</label>
          <button id="runBtn" class="btn btn-primary" disabled>Loading engine…</button>
        </div>
        <div id="err" class="hidden text-xs text-red-300"></div>
      </section>
    </aside>

    <!-- Preview column -->
    <section class="lg:col-span-8 xl:col-span-9 space-y-4">
      <div class="card p-5 flex items-center gap-3">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path d="M3 7h18M7 7l2-3h6l2 3M5 21h14a2 2 0 0 0 2-2V7H3v12a2 2 0 0 0 2 2Z"/>
        </svg>
        <h2 class="text-lg font-semibold">Preview</h2>
        <div class="ml-auto flex items-center gap-2">
          <button id="downloadBtn" class="btn btn-ghost disabled:opacity-50" disabled>Download SVG</button>
        </div>
      </div>

      <div class="flex flex-col gap-4">
        <!-- Input raster -->
        <div class="card overflow-hidden">
          <div class="flex items-center justify-center p-3" style="min-height:60vh;">
            <img id="raster" alt="uploaded" class="w-full h-auto max-h-[85vh] object-contain" />
          </div>
        </div>
        <!-- Output SVG -->
        <div class="card overflow-hidden">
          <div id="svgwrap" class="flex items-center justify-center p-3 text-slate-400 text-sm" style="min-height:60vh; overflow:auto;">
            Upload an image and click <strong class="text-slate-200">Vectorize</strong> to see the SVG here.
          </div>
        </div>
      </div>
      <canvas id="work" class="hidden"></canvas>
    </section>
  </main>

  <!-- ImageTracer from CDN with fallback -->
  <script>
    (function loadImageTracer(){
      function inject(src, onload){ var s=document.createElement('script'); s.src=src; s.defer=true; s.onload=onload; s.onerror=function(){ onload(new Error('Failed '+src)); }; document.head.appendChild(s); }
      function ready(){ return typeof window.ImageTracer !== 'undefined'; }
      function enable(){ $('runBtn').textContent='Vectorize'; $('runBtn').disabled=false; }
      if(ready()){ enable(); return; }
      inject('https://unpkg.com/imagetracerjs/imagetracer_v1.2.6.min.js', function(){ if(ready()) return enable();
        inject('https://cdn.jsdelivr.net/npm/imagetracerjs@1.2.6/imagetracer_v1.2.6.min.js', function(){ if(ready()) enable(); else { const e=$('err'); e.classList.remove('hidden'); e.textContent='Could not load vectorization engine.'; }});
      });
    })();
  </script>

  <script>
    const $ = (id) => document.getElementById(id);
    const st = { k:12, smooth:1, whiteT:245, blackT:25, desat:false, lt:1.0, qt:1.0, omit:8, rc:2, autoprev:true, file:null, svg:null, imgReady:false, working:false };

    // --- Presets (built-in + custom in localStorage) ---
    const BUILTINS = [
      { name:'Logo / Flat',   s:{k:8,  smooth:0, whiteT:250, blackT:15, desat:false, lt:1.2, qt:1.2, omit:6,  rc:1.5}},
      { name:'Poster / Text', s:{k:14, smooth:1, whiteT:245, blackT:25, desat:false, lt:1.3, qt:1.6, omit:10, rc:2  }},
      { name:'Illustration',  s:{k:24, smooth:1, whiteT:242, blackT:22, desat:false, lt:1.0, qt:1.0, omit:8,  rc:2  }},
      { name:'Pixel Art',     s:{k:12, smooth:0, whiteT:255, blackT:0,  desat:false, lt:0.8, qt:0.8, omit:0,  rc:0  }}
    ];
    const LS_KEY='pv_presets_v1';

    function loadCustomPresets(){
      try{ return JSON.parse(localStorage.getItem(LS_KEY)) || []; }catch(e){ return []; }
    }
    function saveCustomPresets(arr){ localStorage.setItem(LS_KEY, JSON.stringify(arr)); }

    function populatePresetSelect(selectName=null){
      const sel = $('presetSelect'); sel.innerHTML='';
      const bgrp=document.createElement('optgroup'); bgrp.label='Built-in';
      BUILTINS.forEach((p,i)=>{ const opt=document.createElement('option'); opt.value='b:'+i; opt.textContent=p.name; bgrp.appendChild(opt); });
      sel.appendChild(bgrp);
      const custom=loadCustomPresets();
      const cgrp=document.createElement('optgroup'); cgrp.label='Custom';
      custom.forEach((p,i)=>{ const opt=document.createElement('option'); opt.value='c:'+i; opt.textContent=p.name; cgrp.appendChild(opt); });
      sel.appendChild(cgrp);
      if(selectName){
        [...sel.options].forEach((o)=>{ if(o.textContent===selectName) sel.value=o.value; });
      } else sel.selectedIndex=0;
    }

    function applySettings(S){ Object.assign(st, S); sync(); if(st.autoprev) run(); }

    $('presetSelect').addEventListener('change', (e)=>{
      const v=e.target.value;
      if(v.startsWith('b:')){ const i=+v.split(':')[1]; applySettings(BUILTINS[i].s); }
      if(v.startsWith('c:')){ const i=+v.split(':')[1]; const arr=loadCustomPresets(); applySettings(arr[i].s); }
    });
    $('savePreset').addEventListener('click', ()=>{
      const name = prompt('Preset name:');
      if(!name) return;
      const arr=loadCustomPresets();
      // overwrite by name if exists
      const idx = arr.findIndex(p=>p.name.toLowerCase()===name.toLowerCase());
      const obj={name, s:{k:st.k, smooth:st.smooth, whiteT:st.whiteT, blackT:st.blackT, desat:st.desat, lt:st.lt, qt:st.qt, omit:st.omit, rc:st.rc}};
      if(idx>=0) arr[idx]=obj; else arr.push(obj);
      saveCustomPresets(arr);
      populatePresetSelect(name);
    });
    $('deletePreset').addEventListener('click', ()=>{
      const sel=$('presetSelect'); const v=sel.value;
      if(!v.startsWith('c:')){ alert('Select a custom preset to delete.'); return; }
      const i=+v.split(':')[1]; const arr=loadCustomPresets(); const name=arr[i].name;
      if(!confirm(`Delete preset "${name}"?`)) return;
      arr.splice(i,1); saveCustomPresets(arr); populatePresetSelect();
    });

    // Label sync
    const sync=()=>{
      $('kVal').textContent=st.k; $('smoothVal').textContent=st.smooth; $('wVal').textContent=st.whiteT; $('bVal').textContent=st.blackT;
      $('ltVal').textContent=st.lt.toFixed(2); $('qtVal').textContent=st.qt.toFixed(2); $('omitVal').textContent=st.omit; $('rcVal').textContent=st.rc;
      $('downloadBtn').disabled=!st.svg;
    };

    // Wiring sliders/toggles
    for(const [id,prop,fmt] of [['k','k'],['smooth','smooth'],['whiteT','whiteT'],['blackT','blackT'],['ltres','lt',v=>+v],['qtres','qt',v=>+v],['pathomit','omit'],['roundcoords','rc']]){
      $(id).addEventListener('input',e=>{ st[prop]=fmt?fmt(e.target.value):+e.target.value; sync(); if(st.autoprev) run();});
    }
    $('desat').addEventListener('change',e=>{ st.desat=e.target.checked; if(st.autoprev) run(); });
    $('autoprev').addEventListener('change',e=>{ st.autoprev=e.target.checked; });
    $('resetAll').addEventListener('click',()=>{ Object.assign(st, {k:12,smooth:1,whiteT:245,blackT:25,desat:false,lt:1.0,qt:1.0,omit:8,rc:2}); sync(); if(st.autoprev) run(); });
    $('downloadBtn').addEventListener('click', ()=>{
      if(!st.svg) return; const blob=new Blob([st.svg],{type:"image/svg+xml;charset=utf-8"});
      const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=(st.file?.name?.replace(/\.[^.]+$/,'')||'vectorized')+'.svg'; a.click(); URL.revokeObjectURL(url);
    });

    // File handling
    $('file').addEventListener('change',ev=>{
      const f=ev.target.files && ev.target.files[0]; st.file=f||null; st.svg=null; st.imgReady=false; $('downloadBtn').disabled=true;
      if(!f){ $('raster').src=''; $('svgwrap').textContent='No file selected.'; return; }
      const r=new FileReader(); r.onload=()=>{ $('raster').onload=()=>{ st.imgReady=true; if(st.autoprev) run(); }; $('raster').src=String(r.result); }; r.readAsDataURL(f);
    });
    $('resetBtn').addEventListener('click', ()=>{ st.file=null; st.svg=null; st.imgReady=false; $('file').value=''; $('raster').src=''; $('svgwrap').textContent='Upload an image and click Vectorize to see the SVG here.'; $('downloadBtn').disabled=true; });

    function alertErr(msg){ const e=$('err'); e.classList.remove('hidden'); e.textContent=msg; setTimeout(()=>e.classList.add('hidden'),5000); }

    // ---- Color utils (sRGB ↔ Lab) ----
    function srgbToXyz(c){ c=c/255; c=c<=0.04045? c/12.92 : Math.pow((c+0.055)/1.055,2.4); return c; }
    function rgb2lab(r,g,b){
      let R=srgbToXyz(r), G=srgbToXyz(g), B=srgbToXyz(b);
      let X=R*0.4124564 + G*0.3575761 + B*0.1804375;
      let Y=R*0.2126729 + G*0.7151522 + B*0.0721750;
      let Z=R*0.0193339 + G*0.1191920 + B*0.9503041;
      const xr=X/0.95047, yr=Y/1.00000, zr=Z/1.08883;
      function f(t){ return t>0.008856? Math.pow(t,1/3) : (7.787*t + 16/116); }
      const fx=f(xr), fy=f(yr), fz=f(zr);
      return [116*fy -16, 500*(fx-fy), 200*(fy-fz)];
    }
    function lab2rgb(L,a,b){
      let fy=(L+16)/116; let fx=a/500 + fy; let fz=fy - b/200;
      function finv(t){ const t3=t*t*t; return t3>0.008856? t3 : (t-16/116)/7.787; }
      const xr=finv(fx), yr=finv(fy), zr=finv(fz);
      const X=xr*0.95047, Y=yr*1.00000, Z=zr*1.08883;
      let R =  3.2404542*X + (-1.5371385)*Y + (-0.4985314)*Z;
      let G = (-0.9692660)*X +  1.8760108*Y +  0.0415560*Z;
      let B =  0.0556434*X + (-0.2040259)*Y +  1.0572252*Z;
      function clamp(v){ return Math.max(0,Math.min(255, Math.round((v<=0.0031308? 12.92*v : 1.055*Math.pow(v,1/2.4)-0.055)*255))); }
      return [clamp(R),clamp(G),clamp(B)];
    }
    function saturation(r,g,b){ const max=Math.max(r,g,b), min=Math.min(r,g,b); return max===0?0:(max-min)/max; }

    // ---- Guided-like smoothing (simple cross mean) ----
    function smoothImage(data,w,h,iters=1){
      if(iters<=0) return data;
      const out=new Uint8ClampedArray(data.length);
      for(let t=0;t<iters;t++){
        for(let y=0;y<h;y++){
          for(let x=0;x<w;x++){
            const i=(y*w+x)*4;
            let accR=0,accG=0,accB=0,accA=0, cnt=0;
            function add(xx,yy){ const j=(yy*w+xx)*4; accR+=data[j]; accG+=data[j+1]; accB+=data[j+2]; accA+=data[j+3]; cnt++; }
            add(x,y);
            if(x>0) add(x-1,y); if(x<w-1) add(x+1,y); if(y>0) add(x,y-1); if(y<h-1) add(x,y+1);
            out[i]=accR/cnt; out[i+1]=accG/cnt; out[i+2]=accB/cnt; out[i+3]=accA/cnt;
          }
        }
        data.set(out);
      }
      return data;
    }

    // ---- KMeans in Lab ----
    function kmeansQuantize(imdata, k, iters=8, sample=2){
      const {data,width,height}=imdata; const N=width*height; const ptsCount=Math.max(1,Math.floor(N/sample));
      const idxs=new Uint32Array(ptsCount); for(let i=0;i<ptsCount;i++) idxs[i]=Math.floor(Math.random()*N);
      const pts=new Float32Array(ptsCount*3);
      for(let i=0;i<ptsCount;i++){ const j=idxs[i]*4; const [L,a,b]=rgb2lab(data[j],data[j+1],data[j+2]); pts[i*3]=L; pts[i*3+1]=a; pts[i*3+2]=b; }
      const C=new Float32Array(k*3); for(let c=0;c<k;c++){ const t=(Math.floor(Math.random()*ptsCount))*3; C[c*3]=pts[t]; C[c*3+1]=pts[t+1]; C[c*3+2]=pts[t+2]; }
      const assign=new Int32Array(ptsCount);
      for(let it=0; it<iters; it++){
        for(let i=0;i<ptsCount;i++){
          let bi=0,bd=1e9; const L=pts[i*3],a=pts[i*3+1],b=pts[i*3+2];
          for(let c=0;c<k;c++){ const dL=L-C[c*3], da=a-C[c*3+1], db=b-C[c*3+2]; const d=dL*dL+da*da+db*db; if(d<bd){bd=d;bi=c;} }
          assign[i]=bi;
        }
        const sum=new Float32Array(k*3); const cnt=new Uint32Array(k);
        for(let i=0;i<ptsCount;i++){ const c=assign[i]; sum[c*3]+=pts[i*3]; sum[c*3+1]+=pts[i*3+1]; sum[c*3+2]+=pts[i*3+2]; cnt[c]++; }
        for(let c=0;c<k;c++){ if(cnt[c]>0){ C[c*3]=sum[c*3]/cnt[c]; C[c*3+1]=sum[c*3+1]/cnt[c]; C[c*3+2]=sum[c*3+2]/cnt[c]; } }
      }
      for(let i=0;i<N;i++){
        const j=i*4; let L_,a_,b_; [L_,a_,b_]=rgb2lab(data[j],data[j+1],data[j+2]);
        let bi=0,bd=1e9; for(let c=0;c<k;c++){ const dL=L_-C[c*3], da=a_-C[c*3+1], db=b_-C[c*3+2]; const d=dL*dL+da*da+db*db; if(d<bd){bd=d;bi=c;} }
        const [r,g,b]=lab2rgb(C[bi*3],C[bi*3+1],C[bi*3+2]); data[j]=r; data[j+1]=g; data[j+2]=b;
      }
      return imdata;
    }

    // ---- Preprocess (dehalo + optional desat) ----
    function preprocess(imdata, whiteT, blackT, desat){
      const d=imdata.data;
      for(let i=0;i<d.length;i+=4){
        let r=d[i], g=d[i+1], b=d[i+2], a=d[i+3];
        if(a<10) continue;
        if(desat){ const y=(0.2126*r+0.7152*g+0.0722*b)|0; r=g=b=y; }
        const s=saturation(r,g,b);
        if((r>=whiteT&&g>=whiteT&&b>=whiteT) || (s<0.12 && r>=whiteT-5&&g>=whiteT-5&&b>=whiteT-5)){ r=g=b=255; }
        else if((r<=blackT&&g<=blackT&&b<=blackT) || (s<0.12 && r<=blackT+5&&g<=blackT+5&&b<=blackT+5)){ r=g=b=0; }
        d[i]=r; d[i+1]=g; d[i+2]=b;
      }
      return imdata;
    }

    // --- Vectorize pipeline ---
    async function run(){
      if(!st.file || !st.imgReady || st.working) return;
      if(typeof window.ImageTracer==='undefined'){ alertErr('Vectorization engine not loaded'); return; }
      st.working=true; const btn=$('runBtn'); const old=btn.textContent; btn.textContent='Vectorizing…'; btn.disabled=true;
      try{
        const img=$('raster'), canvas=$('work'), ctx=canvas.getContext('2d',{willReadFrequently:true});
        const MAX=3000; const scale=Math.min(1, MAX/Math.max(img.naturalWidth||1, img.naturalHeight||1));
        canvas.width=Math.max(1,Math.round((img.naturalWidth||1)*scale)); canvas.height=Math.max(1,Math.round((img.naturalHeight||1)*scale));
        ctx.clearRect(0,0,canvas.width,canvas.height); ctx.drawImage(img,0,0,canvas.width,canvas.height);
        let imdata=ctx.getImageData(0,0,canvas.width,canvas.height);
        imdata=preprocess(imdata, st.whiteT, st.blackT, st.desat);
        smoothImage(imdata.data, canvas.width, canvas.height, st.smooth);
        kmeansQuantize(imdata, st.k, 8, 2);
        const svgstr = ImageTracer.imagedataToSVG(imdata, {
          numberofcolors: st.k, ltres: st.lt, qtres: st.qt, pathomit: st.omit,
          blurradius: 0, blurdelta: 64, roundcoords: st.rc, viewbox: true, desc: true
        });
        st.svg=svgstr; $('svgwrap').innerHTML=svgstr;
      }catch(err){ console.error(err); alertErr("Vectorization failed — "+(err?.message||String(err))); }
      finally{ st.working=false; btn.textContent=old; btn.disabled=false; $('downloadBtn').disabled=!st.svg; }
    }

    // Boot
    function init(){
      // populate presets and select default
      populatePresetSelect();
      // apply default built-in "Poster / Text"
      applySettings(BUILTINS[1].s);
      sync();
    }

    // ---- Setup runtime wiring ----
    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
